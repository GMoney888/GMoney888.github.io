<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Courses</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf_viewer.min.css">
    <style>
        /* Basic CSS */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }

        .course-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .course-card {
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 8px;
        }

        .pdf-viewer-container {
            margin-top: 40px;
            border: 1px solid #ddd;
            padding: 20px;
            height: 600px;
            overflow: auto;
        }

        .buy-button {
            background: #6772e5;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <header>
        <h1>Online Courses</h1>
    </header>

    <div class="course-list">
        <!-- Course cards will be populated by JavaScript -->
    </div>

    <div class="pdf-viewer-container">
        <h2>Course Preview</h2>
        <div id="pdf-viewer"></div>
        <button id="download-pdf" style="margin-top: 20px;">Download PDF</button>
    </div>

    <!-- PDF.js Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.min.js"></script>
    
    <!-- Stripe -->
    <script src="https://js.stripe.com/v3/"></script>

    <script>
        // Stripe Configuration
        const stripe = Stripe('pk_test_your_stripe_public_key_here');
        
        // Sample Course Data
        const courses = [
            {
                id: 'price_1YourPriceID1',
                title: 'Web Development Basics',
                price: 49.99,
                pdfUrl: '/path/to/your-course.pdf'
            },
            // Add more courses as needed
        ];

        // Initialize Course List
        document.addEventListener('DOMContentLoaded', () => {
            const courseList = document.querySelector('.course-list');
            
            courses.forEach(course => {
                const card = document.createElement('div');
                card.className = 'course-card';
                card.innerHTML = `
                    <h3>${course.title}</h3>
                    <p>$${course.price}</p>
                    <button class="buy-button" data-price="${course.id}">Buy Now</button>
                `;
                courseList.appendChild(card);
            });

            // Initialize PDF Viewer
            const pdfViewer = document.getElementById('pdf-viewer');
            const pdfUrl = courses[0].pdfUrl; // Default to first course PDF
            
            pdfjsLib.getDocument(pdfUrl).promise.then(pdf => {
                // Show first page
                pdf.getPage(1).then(page => {
                    const scale = 1.5;
                    const viewport = page.getViewport({ scale });
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;
                    
                    const renderContext = {
                        canvasContext: context,
                        viewport: viewport
                    };
                    
                    page.render(renderContext);
                    pdfViewer.appendChild(canvas);
                });
            });

            // Download PDF Button
            document.getElementById('download-pdf').addEventListener('click', () => {
                const link = document.createElement('a');
                link.href = pdfUrl;
                link.download = 'course-material.pdf';
                link.click();
            });

            // Stripe Checkout Handlers
            document.querySelectorAll('.buy-button').forEach(button => {
                button.addEventListener('click', async (e) => {
                    const priceId = e.target.dataset.price;
                    
                    try {
                        const { error } = await stripe.redirectToCheckout({
                            lineItems: [{ price: priceId, quantity: 1 }],
                            mode: 'payment',
                            successUrl: `${window.location.origin}/success.html`,
                            cancelUrl: `${window.location.origin}/cancel.html`,
                        });
                        
                        if (error) {
                            alert(error.message);
                        }
                    } catch (err) {
                        console.error('Error:', err);
                    }
                });
            });
        });
    </script>
</body>
</html>
